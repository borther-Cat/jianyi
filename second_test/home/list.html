<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>列表页</title>
    <link rel="icon" href="https://www.j1.com/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="./css/base.css">
    <link rel="stylesheet" href="./css/list.css">
    <script src="./js/jquery-3.4.1.js"></script>
</head>
<body>
    <div class="list_header"></div>
    <div class="list_nav"></div>
    <div id="listpagecontainer">
        <div id="listpagecontent" class="clearfix">
            <div class="detailnav">
                    <span><a href="https://www.j1.com/">健一网首页</a></span> <span class="arrow">&gt;</span>
                    &nbsp;
                        <a href="https://www.j1.com/p-15000.html" target="_blank">医疗器械</a>
                        &nbsp;&gt;&nbsp;
                    <span>血糖监测</span>
            </div>
            <div class="listpageleft">
                    <!--list-Screening start-->
                    <div class="list-Screening">
                        <div class="list_h1">医疗器械</div>
                        <div class="listpageChooseBox">
                            <h3>
                                            <a href="https://www.j1.com/p-15201.html">血糖仪套装<span></span>
                                            </a>
                                        </h3>
                                    <ul>
                                    <li></li>
                                </ul>
                            <h3>
                                            <a href="#">血糖仪<span></span>
                                            </a>
                                        </h3>
                                    <ul>
                                    <li></li>
                                </ul>
                            <h3>
                                            <a href="#">胰岛素针头<span></span>
                                            </a>
                                        </h3>
                                    <ul>
                                    <li></li>
                                </ul>
                            <h3>
                                            <a href="#">血糖试纸<span></span>
                                            </a>
                                        </h3>
                                    <ul>
                                    <li></li>
                                </ul>
                            </div>
                    </div>
                    
                    <div id="billboard">
                        <div class="list-Screening">
            <div class="list_h1">
                <span class="fl">一周热卖排行</span><a class="fr" href="">更多》</a>
            </div>
            <div class="listpageBox">
                <ul>
                    </ul>
            </div>
        </div></div>
                   
                    <div>
                        </div>
                    
        <div class="list-Screening">
        
        </div><!-- 推广商品end -->
                  
                    <div class="listleft-tj">
                        <a target="_blank" href="#"><img width="205" height="260" alt="" src="https://img.j1.com/images/xq/xq01.jpg"></a>
                    </div>
                    <div class="listleft-tj">
                        <a target="_blank" href="#"><img width="205" height="260" alt="" src="https://img.j1.com/images/newdetail_left-ad04.jpg"></a>
                    </div>
                    <div class="listleft-tj">
                        <a target="_blank" href="#"><img width="205" height="260" alt="" src="https://img.j1.com/images/newdetail_left-ad03.jpg"></a>
                    </div>
                  
                </div>
            <div class="listpageright">
                <dl class="borderbox clearfix">
                        <dt class="tjtitle">相关推荐：</dt>
                        <dd class="tjdes">
                        </dd>
                    </dl>
                    <div class="j1131025_searchlist">
                            <h1> <em>血糖监测</em></h1>
                                <dl class="choose clearfix">
                                    <dt>您已经选择：</dt>
                                    <dd>
                                        <a href="#" class="rechose">重新筛选</a>
                                    </dd>
                                </dl>
                            <dl class="clearfix choosetype">
                                    <dt>类别：</dt>
                                    <dd id="pl_brand0">
                                        <a href="#">血糖试纸(13) </a>
                                            <a href="#">免条码试纸(2) </a>
                                            <a href="#">独立装试纸(1) </a>
                                            <a href="#">免条码血糖仪(1) </a>
                                            </dd>
                                </dl>
                            <dl class="clearfix choosetype">
                                    <dt>品牌：</dt>
                                    <dd id="pl_brand1">
                                        <a href="#">强生(6) </a>
                                            <a href="#">三诺(6) </a>
                                            <a href="#">罗氏(6) </a>
                                            <a href="#">欧姆龙(6) </a>
                                            <a href="#">康德莱(5) </a>
                                            <a href="#">MICROTECH MEDICAL/微泰医疗(3) </a>
                                            <a href="#">优锐(3) </a>
                                            <a href="#">拜耳(3) </a>
                                            <a href="#">贝朗(2) </a>
                                            <a href="#">欧曼福德(2) </a>
                                            <a href="#">雅培(2) </a>
                                            <a href="#">泰尔茂(1) </a>
                                            <span class="brandmore" style="display:none">更多</span> 
                                        </dd>
                                </dl>
                            <dl class="clearfix choosetype" style="display: none;">
                                    <dt>产地：</dt>
                                    <dd id="pl_brand2">
                                        <a href="#">进口(8) </a>
                                            <a href="#">国产(5) </a>
                                            </dd>
                                </dl>
                            <dl class="clearfix choosetype" style="border-bottom: none;">
                                    <dt>规格：</dt>
                                    <dd id="pl_brand3">
                                        <a href="#">安稳(4) </a>
                                            <a href="#">罗康全活力(2) </a>
                                            <a href="#">罗康全卓越(2) </a>
                                            <a href="#">稳豪型(2) </a>
                                            <a href="#">HEA-232(1) </a>
                                            <a href="#">拜安康(1) </a>
                                            <a href="#">辅理善(1) </a>
                                            </dd>
                                </dl>
                            <div class="morebuttonwrap"><div class="pl_morebutton"><span>显示全部</span></div></div>
                            </div>
                <div class="listsearchmain3">
                    <div class="listsearchmain3-con">
                        <dl class="px">
                            <dt>排序：</dt>
                            <dd>
                                <a rel="nofollow" href="#" class="current"><cite class="fl">默认</cite></a>
                                <a rel="nofollow" href="#"><cite class="fl">价格</cite><span span="" class="up"></span></a>
                                <a rel="nofollow" href="#"><cite class="fl">价格</cite><span span="" class="down"></span></a>
                            </dd>
                        </dl>
                        
                    </div>
                </div>
                <div class="listsearchmain4">
                </div>
            </div>
        </div>
        <div id="page" class="page">
        
        </div>
    </div>
    
    <div class="list_footer"></div>
    <script>
        $(function(){
            let currentType = 0;
            new Promise(function(resolve, reject) {
                $.ajax({
                    type: "get",
                    url: "./server/get_list_page.php",
                    dataType: "json",
                    success: function(response) {
                        console.log(response);
                        let pageCount = response.data;
                        for (let i = 0; i < pageCount; i++) {
                            let oPage = $(`<a href="javascript:;">${i+1}</a>`);
                            $("#page").append(oPage);
                        }
                        $("#page").children("a").first().addClass("active");
                        resolve();
                    }
                });
            }).then(function(){
                getDatWithPage(currentType, 0);
                
            })
            $("#page").on("click", "a", function(e) {
                e.preventDefault();
                $(this).addClass("active").siblings().removeClass("active");
                /* 先获取当前是第几页 */
                let index = $(this).index();
                // console.log(index);
                getDatWithPage(currentType, index);
            })
            let getDatWithPage = (type, page) => {
                $.ajax({
                    type: "get",
                    url: "./server/get_list_data.php",
                    data: `type=${type}&page=${page}`,
                    dataType: "json",
                    success: function(response) {
                        let data = response.data;
                        let itemData = data;
                        console.log(data);
                        var html1="";
                        var html2="";
                        var list_arr =[];
                        data.map((ele ,index) => {
                            
                           var html1_t=`<div class="listsearch-one">
                                        <div class="listsearch-ztimg" >
                                            <span class="sgz">2</span>
                                            <span class="sgz"> 赠品</span>
                                            <center>
                                                <a href="#" target="_blank" rel="nofollow"> 
                                                    <img src=${ele.src}  width="200" height="200">
                                                </a>
                                            </center>
                                        </div>
                                        <div class="listsearch-cx">
                                            </div>
                                        <div class="listsearch-mc">
                                            <a href="#">${ele.del}</a>
                                        </div>
                                        <div class="listsearch-price">
                                            <span class="liststyle2">¥${ele.price}</span>
                                            </div>
                                        <div class="listsearch-des">
                                            <span>${ele.much}</span>
                                                <a class="" href="#">${ele.des}</a>
                                            </div>
                                        <div class="listsearch-xq">
                                            <div class="listshop ">
                                                <a rel="nofollow" href="#"> <span class="shopnow"></span><cite>加入购物车</cite></a>
                                                            </div>
                                            <div class="listcheck ">
                                                <a rel="nofollow"  id=${ele.id} class="nofollow" href="javaScript:void(0);" target="_blank"> 查看详情 </a>
                                            </div>
                                        </div>
                                    </div>`
                                    html1 +=html1_t;
                                    
                                    if((index+1)%4==0 ||index==data.length-1){
                                      
                                      var  html2=`<div class="listsearch-jg">
                                                        ${html1}
                                                    <div class="clear"></div>
                                                </div>`
                                                                         
                                        html1 ="";   
                                       list_arr.push(html2);
                                    }
                                
                        })
                        var html = list_arr.join("")
                        
                        $(".listsearchmain4").html(html); 
                        $(".nofollow").click(function(e){
                            e.preventDefault();
                                let id=$(this).attr("id");
                                window.location.href="http://127.0.0.1/code/second_test/home/detailPag.html?"+"id="+id;
                        })
                     
                        
                        $(".listsearchmain4 cite").click(function(ele){                        
                            var index = $(".listsearchmain4 cite").index(this);
                            var goodid = itemData[index].id;
                            var price = itemData[index].price;
                            console.log(index);
                            $.ajax({
                                    type: "get",
                                    url: "./server/addCart.php",
                                    data: `goodid=${goodid}&price=${price}`,
                                    dataType: "json",
                                    success: function(response) {
                                    // console.log(response);
                                    var text = response["totalRow"];
                                    $("#cartCount").html(text)
                                }
                            }); 
                            
                        })
            
                                        
                    },
                    error: function() {
                        console.log("++");
                    }
                });
            }
            
            
            $(".px").children().children("a").click(function() {
                let index = $(this).index();
                currentType = index;
                getDatWithPage(currentType, 0);
                $(this).addClass("current").siblings().removeClass("current");
                $("#page").children("a").first().addClass("active").siblings().removeClass("active");
            })

           


               
        })
           
    </script>
    <script>
         $(".list_header").append().load("http://127.0.0.1/code/second_test/common/hheader.html")
         $(".list_nav").append().load("http://127.0.0.1/code/second_test/common/nav.html",()=>{
            $("#sidebar-x-1").css("display","none")
              $("#allNav").hover(function () {
            $("#sidebar-x-1").css("display","block")
        },function () {
            $("#sidebar-x-1").css("display","none")
        })
         });
         $(".list_footer").append().load("http://127.0.0.1/code/second_test/common/footer.html")
        
    </script>
</body>
</html>